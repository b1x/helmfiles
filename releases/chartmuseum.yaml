repositories:
  - name: stable
    url: https://kubernetes-charts.storage.googleapis.com

releases:
  - name: chartmuseum
    namespace: devops
    chart: stable/chartmuseum
    version: ~2.6.0
    installed: true
    # wait: true
    values:
      - fullnameOverride: chartmuseum

        replica:
          annotations:
            cluster-autoscaler.kubernetes.io/safe-to-evict: "true"
            iam.amazonaws.com/role: '{{ env "CHARTMUSEUM_IAM_ROLE" }}'

        env:
          open:
            DEBUG: false
            # DISABLE_API: false
            # DISABLE_METRICS: false
            # ALLOW_OVERWRITE: true
            # use amazon s3 storage as backend
            STORAGE: "amazon"
            ### Required: CHARTMUSEUM_STORAGE_AMAZON_BUCKET;
            STORAGE_AMAZON_BUCKET: '{{ requiredEnv "CHARTMUSEUM_STORAGE_AMAZON_BUCKET" }}'
            ### Required: CHARTMUSEUM_STORAGE_AMAZON_PREFIX; e.g. /
            STORAGE_AMAZON_PREFIX: '{{ requiredEnv "CHARTMUSEUM_STORAGE_AMAZON_PREFIX" }}'
            ### Required: CHARTMUSEUM_STORAGE_AMAZON_REGION; e.g. us-west-2
            STORAGE_AMAZON_REGION: '{{ requiredEnv "CHARTMUSEUM_STORAGE_AMAZON_REGION" }}'
          # secret:
          #   ### Required: CHARTMUSEUM_BASIC_AUTH_USER; e.g. server
          #   BASIC_AUTH_USER: '{{ env "CHARTMUSEUM_BASIC_AUTH_USER" }}'
          #   ### Required: CHARTMUSEUM_BASIC_AUTH_PASS; e.g. 924426A5-DA22-4A10-9FB1-418761684372
          #   BASIC_AUTH_PASS: '{{ env "CHARTMUSEUM_BASIC_AUTH_PASS" }}'

        ingress:
          enabled: true
          annotations:
            kubernetes.io/ingress.class: nginx
            nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
            nginx.ingress.kubernetes.io/proxy-body-size: 500m
            ingress.kubernetes.io/proxy-body-size: 500m
            cert-manager.io/cluster-issuer: "letsencrypt-prod"
          hosts:
            - name: '{{ env "CHARTMUSEUM_HOST" }}'
              path: /
              tls: true
              tlsSecret: chartmuseum-tls
